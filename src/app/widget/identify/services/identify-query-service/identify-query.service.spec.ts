import { TestBed } from '@angular/core/testing';

import { IdentifyQueryService } from './identify-query.service';
import { AxiosRequestHeaders, AxiosResponse } from 'axios';

describe('IdentifyQueryService', () => {
  let service: IdentifyQueryService;
  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(IdentifyQueryService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });

  it('Deberia consultar la informacion de la geometria', async () => {
    const mockResponse: AxiosResponse = {
      data: {
        type: 'FeatureCollection',
        totalFeatures: 'unknown',
        features: [
          {
            type: 'Feature',
            id: 'Areas_Clave_Biodiversidad_KBA.112',
            geometry: {
              type: 'MultiPolygon',
              coordinates: [
                [
                  [
                    [-73.12424078, 2.21770498],
                    [-73.15817103, 2.16330713],
                    [-73.09759877, 2.08891441],
                    [-73.01551383, 2.07368479],
                    [-72.99539754, 2.02556679],
                    [-72.87488936, 1.99249878],
                    [-72.78054825, 1.91724964],
                    [-72.78349788, 1.79245146],
                    [-72.71088468, 1.80475303],
                    [-72.6993815, 1.78182146],
                    [-72.69238586, 1.63430932],
                    [-72.59664174, 1.49923867],
                    [-72.63724246, 1.43321546],
                    [-72.56171849, 1.37032503],
                    [-72.54934131, 1.29894171],
                    [-72.47920305, 1.26759745],
                    [-72.45567148, 1.22222985],
                    [-72.37124502, 1.20432711],
                    [-72.35793839, 1.25538628],
                    [-72.31969186, 1.26374211],
                    [-72.32120833, 1.14823036],
                    [-72.34215038, 1.11525816],
                    [-72.40256435, 1.11376394],
                    [-72.44580716, 1.05834828],
                    [-72.37665131, 0.95820001],
                    [-72.39261407, 0.91876811],
                    [-72.33946384, 0.92484878],
                    [-72.32828034, 0.83847708],
                    [-72.32301544, 0.8743993],
                    [-72.28936507, 0.87354502],
                    [-72.2950279, 0.78226484],
                    [-72.26448265, 0.76165738],
                    [-72.26988151, 0.79288797],
                    [-72.24980652, 0.78811226],
                    [-72.21360241, 0.70245491],
                    [-72.12673521, 0.74122411],
                    [-72.06984667, 0.6933154],
                    [-72.08330817, 0.65765559],
                    [-71.99792407, 0.65860753],
                    [-71.98085721, 0.62826313],
                    [-72.01100501, 0.59721948],
                    [-71.95330139, 0.54044496],
                    [-71.93832578, 0.57136225],
                    [-71.91241041, 0.5156134],
                    [-71.92846937, 0.48794761],
                    [-71.900731, 0.47350514],
                    [-71.91988151, 0.45283278],
                    [-71.88418355, 0.47000939],
                    [-71.82251887, 0.40687941],
                    [-71.85155824, 0.35145755],
                    [-71.76690236, 0.3704885],
                    [-71.78779966, 0.33518281],
                    [-71.7525687, 0.33368989],
                    [-71.73810809, 0.28646125],
                    [-71.70382283, 0.31846035],
                    [-71.72505973, 0.28041191],
                    [-71.69538505, 0.23652128],
                    [-71.62322394, 0.21641868],
                    [-71.63600081, 0.18390641],
                    [-71.56143162, 0.21753367],
                    [-71.58852101, 0.1659475],
                    [-71.52635245, 0.16112317],
                    [-71.54349223, 0.13221332],
                    [-71.56341083, 0.14472705],
                    [-71.58111763, -0.00527],
                    [-71.70482636, -0.06729317],
                    [-71.73645783, -0.15453339],
                    [-71.71048537, -0.23377782],
                    [-71.73750305, -0.25000006],
                    [-71.86250782, -0.27018198],
                    [-71.8288948, -0.22533974],
                    [-71.8734087, -0.17413234],
                    [-71.82543366, -0.09980966],
                    [-71.88124391, -0.06364401],
                    [-71.99433219, -0.13009904],
                    [-72.0964229, -0.13049197],
                    [-72.11428646, -0.07858156],
                    [-72.18265719, -0.14494358],
                    [-72.22541772, -0.10298885],
                    [-72.26662647, -0.11527802],
                    [-72.26188559, -0.14201294],
                    [-72.34628611, -0.16529069],
                    [-72.41416931, -0.11750005],
                    [-72.42500306, -0.14125007],
                    [-72.44791412, -0.09833337],
                    [-72.47166443, -0.11500002],
                    [-72.60083007, -0.09000007],
                    [-72.63417053, -0.0333334],
                    [-72.70429117, -0.09262454],
                    [-72.90583291, -0.09262454],
                    [-73.02821693, -0.04868513],
                    [-73.073116, -0.0015717],
                    [-73.11566366, -0.00355816],
                    [-73.14567825, 0.04253205],
                    [-73.14567846, -0.01842998],
                    [-73.20166778, -0.07166677],
                    [-73.20166778, -0.045],
                    [-73.34750366, -0.03124997],
                    [-73.37041474, 0.00416664],
                    [-73.47416687, -0.01999999],
                    [-73.53166962, 0.02583328],
                    [-73.56333161, -0.01666667],
                    [-73.62666321, 0.04083338],
                    [-73.71624756, 0.03999993],
                    [-73.76750182, -0.00854168],
                    [-73.80291749, 0.03500001],
                    [-73.8345871, 0.01083338],
                    [-73.88999939, 0.03166664],
                    [-73.89333344, 0.15749993],
                    [-73.92541227, 0.18020502],
                    [-73.84531779, 0.29717041],
                    [-73.99333191, 0.50791669],
                    [-73.97958374, 0.53999996],
                    [-74.01780942, 0.59459021],
                    [-73.98413453, 0.64948103],
                    [-74.01336577, 0.66183845],
                    [-74.01013783, 0.71414586],
                    [-74.07039631, 0.757464],
                    [-74.0893957, 0.85549522],
                    [-74.10548987, 0.83995887],
                    [-74.15018954, 0.88208859],
                    [-74.16354049, 0.86728494],
                    [-74.17671109, 0.91830014],
                    [-74.1889977, 0.90085848],
                    [-74.23951803, 0.9296051],
                    [-74.32379427, 1.07218053],
                    [-74.1076846, 1.19433537],
                    [-74.08271894, 1.29515052],
                    [-74.03297022, 1.24904457],
                    [-73.98194974, 1.24504233],
                    [-73.99064306, 1.29020027],
                    [-73.96042891, 1.34441639],
                    [-73.88586607, 1.36445138],
                    [-73.85593581, 1.4422918],
                    [-73.88225219, 1.53940814],
                    [-73.81852921, 1.57082822],
                    [-73.79412183, 1.6330301],
                    [-73.73866603, 1.64130178],
                    [-73.67012236, 1.60692537],
                    [-73.56307123, 1.65732945],
                    [-73.51968439, 1.63402248],
                    [-73.50062295, 1.65951689],
                    [-73.4564161, 1.63838988],
                    [-73.29579488, 1.64547895],
                    [-73.30037171, 1.66839481],
                    [-73.31966913, 1.65487947],
                    [-73.37720906, 1.68934835],
                    [-73.35527619, 1.80248244],
                    [-73.3878481, 1.8904471],
                    [-73.50613136, 2.03536633],
                    [-73.44238248, 2.07153636],
                    [-73.3490275, 2.06190068],
                    [-73.28860199, 2.21462812],
                    [-73.25514986, 2.17341055],
                    [-73.25509758, 2.24636628],
                    [-73.126164, 2.24697187],
                    [-73.12424078, 2.21770498],
                  ],
                ],
              ],
            },
            geometry_name: 'geom',
            properties: {
              sitrecid: 19049,
              region: 'South America',
              country: 'Colombia',
              iso3: 'COL',
              natname: 'Parque Nacional Natural Serranía de Chiribiquete',
              intname: 'Serrania de Chiribiquete Natural National Park',
              sitlat: 0.79350619,
              sitlong: -73.01890184,
              sitareakm2: 42661.687081,
              kbastatus: 'confirmed',
              kbaclass: 'Global',
              ibastatus: 'confirmed',
              azestatus: null,
              lastupdate: '2023',
              source: 'IBA Directory Process',
              deltxt:
                'New boundaries were stablished to follow exactly the limits of the entire Serrania El Chiribequete Natural National Park',
              shape_leng: 1749420.27934,
              factsheet:
                'https://www.keybiodiversityareas.org/site/factsheet/19049',
              fuentecapa:
                "<a href= https://www.keybiodiversityareas.org/ target='_blank'>Key Biodiversity Areas Partnership</a>",
              fecha_capa: '07/OCT/2024',
              info_capa:
                "<a href= https://workdrive.zohoexternal.com/sheet/open/updeo4933cb276de74edd9b324b630bbe7d34?sheetid=0&range=A43&authId=%7B%22linkId%22%3A%223XUVhVrRjv6-OQgeA%22%7D  target='_blank'>Abrir información</a>",
            },
          },
        ],
        crs: {
          type: 'name',
          properties: {
            name: 'urn:ogc:def:crs:EPSG::4326',
          },
        },
      },
      status: 200,
      statusText: 'OK',
      headers: {},
      config: { headers: {} as AxiosRequestHeaders },
    };
    spyOn(service['axiosInstance'], 'get').and.returnValue(
      Promise.resolve(mockResponse)
    );
    const result = await service.searchWFSFeature('http://mock.com');
    expect(result).toEqual(mockResponse.data);
  });

  it('debería retornar los datos si la respuesta es 200', async () => {
    const mockAxiosResponse: AxiosResponse = {
      data: '<xml>respuesta</xml>',
      status: 200,
      statusText: 'OK',
      headers: {},
      config: { headers: {} as AxiosRequestHeaders },
    };
    spyOn(service['axiosInstance'], 'get').and.returnValue(
      Promise.resolve(mockAxiosResponse)
    );

    const result = await service.searchWMSFeatureInfo('https://fake-url.com');

    expect(result).toEqual(mockAxiosResponse.data);
  });
});
